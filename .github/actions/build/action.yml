name: 'Build docs'
decsription: 'Build v3 and v4 docs'
runs:
  using: "composite"
  steps:
    - uses: actions/setup-node@v1
      with:
        node-version: '12'
    - uses: actions/cache@v2
      id: yarn-cache
      name: Load v3 and v4 npm deps from cache
      with:
        path: '**/node_modules'
        key: ${{ runner.os }}-yarn-${{ hashFiles('yarn.lock') }}
    - run: |
        if [[ "${{steps.yarn-cache.outputs.cache-hit}}" != "true" ]]; then
          yarn install --frozen-lockfile
        fi

      shell: bash
    # v4 build
    - uses: actions/cache@v2
      id: v4-cache
      name: Load webpack cache
      with:
        path: 'packages/v4/.cache'
        key: ${{ runner.os }}-v4-${{ hashFiles('yarn.lock') }}
    - run: yarn build:v4
      name: Build docs
    # v3 build
    - uses: actions/cache@v2
      id: v3-artifact-cache
      name: Load v3 artifact from cache
      with:
        path: 'build/patternfly-org/v3'
        key: ${{ runner.os }}-build-${{ hashFiles('packages/v3/*', 'packages/v3/**') }}
    - uses: actions/setup-ruby@v1
      with:
        ruby-version: '2.6'
    - run: |
        if [[ "${{steps.v3-artifact-cache.outputs.cache-hit}}" != "true" ]]; then
          cd packages/v3 && bundle install --jobs 4 --retry 3
        fi

      name: Install v3 ruby deps
      shell: bash
    - run: |
        if [[ "${{steps.v3-artifact-cache.outputs.cache-hit}}" != "true" ]]; then
          yarn build:v3
        fi

      name: Build v3 docs
      shell: bash

